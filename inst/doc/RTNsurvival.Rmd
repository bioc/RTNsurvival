---
title: "RTNsurvival: An R/Bioconductor package for survival analysis from transcriptional networks."
author: "Clarice S. Groeneveld, VinÃ­cius S. Chagas, Mauro A. A. Castro"
date: "2016-10-07"
output: BiocStyle::html_document
vignette: >
  %\VignetteIndexEntry{"RTNsurvival: An R/Bioconductor package for survival analysis and plots from transcriptional networks"}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Overview

RTNsurvival is a tool for integrating transcriptional networks generated by RTN with survival information for a cohort. It visualizes the integrated data using 2-tailed Gene Set Enrichment Analysis (GSEA2) as a base for the survival plots. 

Transcriptional networks are important tools to visualize complex biological systems that involve large groups of genes and multiple regulators. RTN is an R/Bioconductor package which can be used to reconstruct transcriptional regulatory networks. It identifies regulons, consisting of a master regulator and target genes. A regulon can be further analyzed to investigate, for example, the effect of its expression on survival probabilities.

This package is implemented using an S4 class and methods for the plots and analyses. There are two main survival analyses generated by RTNsurvival: a Proportional Hazards model (Cox) analysis and plot, seen in Figure 1, and a Kaplan-Meier panel (Figure 2), which has a of a Differential Enrichment Score (dES) plot for all samples, a co-variates status plot and a Kaplan-Meier curve for samples with different dES scores. The plots can be fine tuned to the user's specifications. An additional wrapper for the function tna.plot.gsea2 is provided to make GSEA2 plots for specific tumor samples (Figure 3).

# Quick Start

## Create a TNI object

RTNsurvival uses the RTN package data to compute a `TNI-class` object. 

```
data(dt4rtn, package="RTN")
```

This data object is a list which contains an expression matrix (`dt4rtn$gexp`), an annotation data.frame for the genes (`dt4rtn$gexpIDs`),
a differential expression vector (`dt4rtn@pheno`) and annotation table (`dt4rtn$phenoIDs`), a vector with differentially expressed genes (`dt4rtn$hits`) and a transcription factor vector (`tfs`). Only the gexp, gexpIDs and tfs are necessary in this instance to create a `TNI-class`. The example `TNI-class` will contain three regulons, reconstructed using the regulators FOXM1, E2F2 and PTTG.

```
rtni <- new("TNI", gexp=dt4rtn$gexp, transcriptionFactors=dt4rtn$tfs[c("FOXM1","E2F2","PTTG1")])
rtni <- tni.preprocess(rtni,gexpIDs=dt4rtn$gexpIDs, verbose=FALSE)
rtni<-tni.permutation(rtni, nPermutations=100, verbose=FALSE) #sets 'nPermutations'>=1000
rtni<-tni.dpi.filter(rtni, verbose=FALSE)
```

## Load survival data
The package provides a sample survival table of clinical data from the METABRIC database where the expression data for the TNI was obtained.

```
data(survival.data)
```

## Create a TNS object
The `TNS` object can be created using the `tnsPreprocess` method. A survival table must be provided with time and event columns. A `TNI` object must also be provided. Key covariables can also be specified and used to compute the Cox analysis. 

```
rtns <- tnsPreprocess(rtni, survival.data, keycovar = c("Grade","Age"), time = 1, event = 2)
```

## Run the GSEA2 analysis

All survival analyses depend on the 2-tailed Gene Set Enrichment Analysis, which generates Enrichment Scores for all the samples and regulons based on the regulons' activities. This analysis uses the `tni.gsea2` function from RTN.

```
rtns <- tnsGsea2(rtns, verbose=FALSE)
```

## Run the Cox analysis

Once the Enrichment Scores (ES) have been computed by `tnsGsea2`, it is possible to run the survival panel and Cox analysis.

```
tnsCox(rtns, regs = c("PTTG1","E2F2","FOXM1"), sortregs = TRUE, plotpdf = FALSE)
```

The `tnsCox` method generates a Cox multivariate regression plot shows the proportional hazards of each of the specified regulons and the provided key covariables and their contribution to survival. The method uses the Bioconductor survival package to fit the model in order to make the plot. 

![title](figures/coxplot.png)
<legend><b>Figure 1</b> - The plot shows the Hazard Ratio for all key covariables and regulons. Lines that are completely to the right of the dashed line, shown in red, are positively associated with hazard. This means that samples with high expression of this regulon have poor prognostic. The further to the right or left of the dashed line, the more significant is the association.</legend>

## Run the Kaplan-Meier analysis

The `tnsKm` method generates a Kaplan-Meier plot, which consists of three plots put together: a ranked differential expression (dES) plot for the cohort, a status of key attributes plot (optional) and and a Kaplan-Meier plot, showing curves for lower dES and higher dES samples.

```
tnsKm(rtns, regs="FOXM1", attribs = list(c("ER+","ER-"),c("G1","G2","G3")), plotpdf = FALSE)
```

![title](figures/FOXM1survplot.png)
<legend><b>Figure 2</b> - The Kaplan-Meier plot for FOXM1 shows that samples with high expression of the genes (red and pink) in this regulon have poorer prognostic than those with low expression, as their survival probability is lower than the samples that have low expression of this regulon (in light and dark blue).</legend>

## Run the 2-tailed GSEA

Individual sample differential expression (dES) can be investigated using the `tns.plot.gsea2` function. This will generate a GSEA plot for the differential expression of both positive and negative targets of the regulon. This step takes a little longer because the GSEA2 is recomputed for that regulon.

```
tns.plot.gsea2(rtns, "MB-5115", regs = "FOXM1")
```

![title](figures/MB-5115_FOXM1.png)
<legend><b>Figure 3</b> - The 2-tailed GSEA plot for the MB-5116 sample. It shows that the positive targets of the regulator are positively enriched, while the negative targets are negatively enriched. </legend>